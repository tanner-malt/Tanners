# Build and Deployment Workflow Overview

This document outlines the local development, build, testing, and deployment processes for the project.

## 1. Local Development Workflow

*   **Hugo Server:** Local development and previewing of the Hugo static site are typically done using Hugo's built-in server.
    *   Command: `hugo server` or `hugo server -D` (to include draft content).
    *   This provides live reloading and allows for quick iteration on content and layout changes.
*   **Node.js Server Not Used Locally:** The Express.js server (defined in `package.json` and `server/` directory) is **not** run during local development of the Hugo site. It is intended for the deployed production environment.
*   **Content Creation:** New content (especially blog posts) can be created using the `new_blog.ps1` PowerShell script, which leverages `hugo new` and archetypes (see `docs/content_generation_flow.md`).

## 2. Continuous Integration (CI) - Automated Testing

Defined in `.github/workflows/test.yml`:

*   **Triggers:** CI tests run automatically on every `push` and `pull_request` to the `main` branch.
*   **Environment:** Ubuntu latest, Node.js version 18.
*   **Steps:**
    1.  **Checkout Code:** `actions/checkout@v3` fetches the repository code.
    2.  **Setup Node.js:** `actions/setup-node@v3` prepares the Node.js environment.
    3.  **Install Dependencies:** `npm install` installs all Node.js dependencies listed in `package.json` (including `express`, `winston`, `jest`, `puppeteer`, `eslint`, etc.).
    4.  **Run Unit Tests:** `npm run test:unit` executes Jest unit tests.
    5.  **Run Integration Tests:** `npm run test:integration` executes Jest/Puppeteer integration tests.
    6.  **Upload Artifacts:** `actions/upload-artifact@v3` uploads:
        *   `coverage/` directory: Contains code coverage reports generated by Jest.
        *   `logs/` directory: Captures any logs generated during the test execution (e.g., if server-side tests were to run and produce Winston logs).
*   **Missing CI Steps (from `package.json` build script):**
    *   The `npm run lint` step is not explicitly run in `test.yml`.
    *   The `npm run test:report` (custom Jest reporter) is not explicitly run in `test.yml`.

## 3. Production Build Process

The production build process is orchestrated by GitHub Actions, primarily for deploying to IONOS.

*   **Workflow:** `Tanners-orchestration.yaml` -> `Tanners-build.yaml`.
*   **Steps (defined in `Tanners-build.yaml`):
    1.  **Checkout Code:** `actions/checkout@v4` (includes submodules).
    2.  **Setup Hugo:** `peaceiris/actions-hugo@v2` sets up the latest extended version of Hugo.
    3.  **Build Hugo Assets:** `run: hugo` compiles the Hugo site. The output is generated in the `./public/` directory (defined by `env: DEPLOYMENT_FOLDER: ./public/`).
    4.  **Store Deployment Content:** `ionos-deploy-now/artifact-action@v1` uploads the contents of `./public/` to IONOS. This artifact is versioned with the Git SHA and associated with a specific branch ID.
        *   It uses a configuration file: `.deploy-now/Tanners/config.yaml` (the contents of this file determine how IONOS handles the project, e.g., if it's purely static or has other requirements).

*   **Note on `package.json` Build Script:** The `npm run build` script (`npm run test:all && npm run lint`) from `package.json` is **not** directly part of the Hugo build workflow (`Tanners-build.yaml`). The testing aspects are handled by `test.yml` (though linting is currently missing there). The `hugo` command in `Tanners-build.yaml` solely builds the static site.

## 4. Deployment Process (to IONOS)

Deployment is handled by IONOS Deploy Now, orchestrated by GitHub Actions.

*   **Workflows:** `Tanners-orchestration.yaml` triggers `Tanners-build.yaml` for the build, and then `deploy-to-ionos.yaml` (via `workflow_dispatch` from IONOS platform) handles the actual deployment.
*   **Steps (defined in `deploy-to-ionos.yaml` after build artifact is available):
    1.  **Trigger:** Typically initiated by IONOS platform via `workflow_dispatch` once a build artifact is ready and a deployment is requested.
    2.  **Download Artifact:** The previously built and uploaded Hugo site (from `./public/`) is downloaded from IONOS artifact storage.
    3.  **Template Rendering & URL Replacement:** Site URL placeholders are replaced with the actual live site URL.
    4.  **Deploy to IONOS Infrastructure:** `ionos-deploy-now/deploy-to-ionos-action@v2` deploys the static files (downloaded artifact) to the IONOS hosting environment, likely using SSH.
    5.  **Status Updates:** The workflow updates IONOS with the deployment status (in progress, success, failure).

**Node.js Server Deployment:**
*   **Not Explicitly Defined:** The current GitHub Actions workflows (`Tanners-orchestration.yaml`, `Tanners-build.yaml`, `deploy-to-ionos.yaml`) **do not include steps for deploying the Node.js/Express server** (e.g., `npm install` on a server, starting the Node.js process, managing it with a process manager).
*   **Possible Scenarios:**
    *   The Node.js server is not currently part of the IONOS deployment.
    *   IONOS Deploy Now might handle Node.js applications based on the `.deploy-now/Tanners/config.yaml` and an appropriate project type setting on IONOS, but this is not evident from the workflow files themselves.
    *   It's deployed via a separate, undocumented mechanism.

## Summary

The project uses Hugo for static site generation and a Node.js/Express application (likely for backend tasks in production, though not run locally for Hugo dev). Local development uses `hugo server`. CI via GitHub Actions (`test.yml`) runs Node.js unit and integration tests. Deployment to IONOS is managed by a set of GitHub Actions workflows that build the Hugo site and deploy the static `public/` directory. The deployment of the Node.js server component is not explicitly detailed in the reviewed CI/CD workflows for the Hugo site. 